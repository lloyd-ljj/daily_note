## 1. mybatis selectKey before insert

今天看代码看到一段很有意思的代码

```xml
<insert id="insert" parameterType="com.didichuxing.prado.ab.dal.model.ABTestConfigInfoDO">
    <selectKey resultType="java.lang.Long" keyProperty="id" order="AFTER">
        SELECT LAST_INSERT_ID()
    </selectKey>
    insert into xx_config_info (id, name, status
    )
    values (#{id,jdbcType=BIGINT}, #{name,jdbcType=VARCHAR}, #{status,jdbcType=VARCHAR},
    #{bizId,jdbcType=INTEGER}
    )
</insert>
```

**作用：返回主键的值**

| 属性        | 描述                                                         |
| ----------- | ------------------------------------------------------------ |
| keyProperty | selectKey 语句结果应该被设置的目标属性。                     |
| resultType  | 返回的结果类型                                               |
| Order       | 可以被设置为 BEFORE 或 AFTER。<br />如果设置为 BEFORE,那么它会首先选择主键,设置 keyProperty 然后执行插入语句。<br />如果设置为 AFTER,那么先执行插入语句,然后是 selectKey 元素 |

#### Notice:

SelectKey需要注意order属性，像Mysql一类支持自动增长类型的数据库中，order需要设置为after才会取到正确的值。

像Oracle这样取序列的情况，需要设置为before，否则会主键错误问题。

#### Summary: 

上面那种情况实际是为了insert之后，能够返回主健的值。一般insert返回的是1-成功，0-失败。

---





